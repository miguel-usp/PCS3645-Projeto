<!DOCTYPE html>
<html>
    <head>
        <title>Miguelopolis - Controle de Rotas</title>
    </head>
    <body>
        <h2>Miguelopolis - Controle de Rotas</h2>
        <p>Insira suas rotas abaixo!</p>
        
            <div id="routes">
            </div>
        
        <button onclick="makeRequest()">Enviar</button>
    </body>
    <script>
        vehicles = 3
        directions = []
        for(i = 0; i < vehicles; i++) {
            document.getElementById("routes").innerHTML += "<h4>Veículo " + (i + 1) + "</h4> \
                                                            <table id=\"route_" + i + "\"> \
                                                            </table> \
                                                            <div> \
                                                            Adicionar Direção: <button onclick=\"addDirection(" + i + ")\">+</button> \
                                                            </div>"
            directions[i] = 0
        }

        function addDirection(i) {
            document.getElementById("route_" + i).innerHTML += "<tr id=\"direction_" + i + "_" + directions[i] + "\"> \
                                                                    <td> \
                                                                        <input type=\"radio\" class=\"selection\" vehicle=" + i + " name=\"selection_" + i + "_" + directions[i] + "\" value=\"2\"> \
                                                                        <label for=\"selection_" + i + "_" + directions[i] + "\">&uarr;</label> \
                                                                    </td> \
                                                                    <td> \
                                                                        <input type=\"radio\" class=\"selection\" vehicle=" + i + " name=\"selection_" + i + "_" + directions[i] + "\" value=\"8\"> \
                                                                        <label for=\"selection_" + i + "_" + directions[i] + "\">&darr;</label> \
                                                                    </td> \
                                                                    <td> \
                                                                        <input type=\"radio\" class=\"selection\" vehicle=" + i + " name=\"selection_" + i + "_" + directions[i] + "\" value=\"4\"> \
                                                                        <label for=\"selection_" + i + "_" + directions[i] + "\">&larr;</label> \
                                                                    </td> \
                                                                    <td> \
                                                                        <input type=\"radio\" class=\"selection\" vehicle=" + i + " name=\"selection_" + i + "_" + directions[i] + "\" value=\"1\"> \
                                                                        <label for=\"selection_" + i + "_" + directions[i] + "\">&rarr;</label> \
                                                                    </td> \
                                                                    <td> \
                                                                        Remover: <button onclick=\"deleteDirection(" + i + ", " + directions[i] + ")\">-</button> \
                                                                    </td> \
                                                                </tr>"
            directions[i] += 1
        }

        function deleteDirection(vehicle, direction) {
            document.getElementById("direction_" + vehicle + "_" + direction).remove()
        }

        function makeRequest() {
            dirs = {
                directions: []
            }
            inputs = document.getElementsByClassName("selection")

            vehicle = -1

            for(i = 0; i < inputs.length; i++) {
                if(inputs[i].checked) {
                    if(vehicle != inputs[i].getAttribute("vehicle")) {
                        vehicle = inputs[i].getAttribute("vehicle")

                        dirs.directions.push({
                            vehicle: vehicle,
                            direction: [inputs[i].value]
                        })
                    }

                    else {
                        dirs.directions[vehicle].direction.push(inputs[i].value)
                    }
                }
            }

            console.log(dirs)

            const xhr = new XMLHttpRequest();
            xhr.open("POST", ""); //PUT ENDPOINT HERE!
            xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8")

            xhr.onload = () => {
                if (xhr.readyState == 4 && xhr.status == 201) {
                    console.log(JSON.parse(xhr.responseText))
                } else {
                    console.log("Error: " + xhr.status)
                }
            };

            xhr.send(dirs)
        }
    </script>
</html>